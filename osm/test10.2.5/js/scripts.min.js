function links(){return xmlhttp=new XMLHttpRequest,xmlhttp.open("GET","http://localhost/test10/php/category_id_list.php",!1),xmlhttp.send(),200==xmlhttp.status?mainLinks=JSON.parse(xmlhttp.responseText):void alert("Ошибка "+xmlhttp.status+": "+xmlhttp.statusText)}function heatmap_categore_id(){return heatmap_category_id=new ol.layer.Heatmap({source:new ol.source.Vector({url:mainLinks[i].link,projection:"EPSG:3857",format:new ol.format.GeoJSON}),radius:3,visible:!0,name:mainLinks[i].category_description}),heatmap_category_id}function buildLayerTree(layer){var elem,name=layer.get("name")?layer.get("name"):"Group",div="<li data-layerid='"+name+"'><span><i class='glyphicon glyphicon-file'></i> "+layer.get("name")+"</span><i class='glyphicon glyphicon-check'></i> ";if(layer.getLayers){for(var sublayersElem="",layers=layer.getLayers().getArray(),len=layers.length,i=len-1;i>=0;i--)sublayersElem+=buildLayerTree(layers[i]);elem=div+" <ul>"+sublayersElem+"</ul></li>"}else elem=div+" </li>";return elem}function initializeTree(){var elem=buildLayerTree(map.getLayerGroup());$("#layertree").empty().append(elem),$(".tree li:has(ul)").addClass("parent_li").find(" > span").attr("title","Collapse this branch"),$(".tree li.parent_li > span").on("click",function(e){var children=$(this).parent("li.parent_li").find(" > ul > li");children.is(":visible")?(children.hide("fast"),$(this).attr("title","Expand this branch").find(" > i").addClass("glyphicon-plus").removeClass("glyphicon-minus")):(children.show("fast"),$(this).attr("title","Collapse this branch").find(" > i").addClass("glyphicon-minus").removeClass("glyphicon-plus")),e.stopPropagation()})}function findBy(layer,key,value){if(layer.get(key)===value)return layer;if(layer.getLayers)for(var result,layers=layer.getLayers().getArray(),len=layers.length,i=0;len>i;i++)if(result=findBy(layers[i],key,value))return result;return null}links();for(var i=0;i<mainLinks.length;i++)mainLinks[i].link="http://localhost/test10/php/category_id_"+(i+1)+".php";console.log(mainLinks);for(var centerPoint=[{lon:24.018425,lat:49.833631,zoom:12}],osmLayer=new ol.layer.Tile({source:new ol.source.OSM({layer:"osm"}),name:"OSM"}),heatmap_category_group=[],i=0;i<mainLinks.length;i++)heatmap_category_group.push(heatmap_categore_id(i,mainLinks));console.log("heatmap_category_group",heatmap_category_group);var layerHeatmap=new ol.layer.Group({layers:heatmap_category_group.reverse(),name:"Heatmap Group"}),map=new ol.Map({target:"map",renderer:"canvas",layers:[osmLayer,layerHeatmap],view:new ol.View({center:ol.proj.transform([centerPoint[0].lon,centerPoint[0].lat],"EPSG:4326","EPSG:3857"),zoom:centerPoint[0].zoom})});map.getLayerGroup().set("name","Root"),$(document).ready(function(){initializeTree(),$("i").on("click",function(){var layername=$(this).closest("li").data("layerid"),layer=findBy(map.getLayerGroup(),"name",layername);layer.setVisible(!layer.getVisible()),layer.getVisible()?$(this).removeClass("glyphicon-unchecked").addClass("glyphicon-check"):$(this).removeClass("glyphicon-check").addClass("glyphicon-unchecked")}),$("#statistic").append("<table></table>");for(var table=$("#statistic").children(),i=0;i<mainLinks.length;i++)table.append("<tr><td>"+mainLinks[i].category_id+"</td><td>"+mainLinks[i].category_description+"</td><td>"+mainLinks[i].number+"</td></tr>")}),function($){}(jQuery);